#include "nnnn_examples.h"

// 根据 nnnn.md 示例文件的正确实现
// 6/8拍：8分音符为一拍，每小节6个8分音符
// 八度：1h=高音(八度5), 1=中音(八度4), 1L=低音(八度3)
// 时值规则：
// - 3h = 四分音符（无下划线）
// - 3h_ = 八分音符（一条下划线）
// - 3h__ = 十六分音符（两条下划线）
// - 3h_-_ = 八分音符+延音（基础八分音符延长一倍）

// 示例：3h 2h_ 1h 2h_ | 3h_-_ 4h__ 3h_ 2h-
// 按照6/8拍 BPM=97，基础单位为八分音符619ms

NumberedNote example_melody[] = {
    // 小节1: 3h 2h_ 1h 2h_ | 
    {3, 5, 0, 0, 0, 0},    // 3h - 高音3，四分音符，1238ms
    {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    {1, 5, 0, 0, 0, 0},    // 1h - 高音1，四分音符，1238ms
    {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    
    // 小节2: 3h_-_ 4h__ 3h_ 2h-
    {3, 5, 0, 1, 1, 0},    // 3h_-_ - 高音3，八分音符+延音=1238ms
    {4, 5, 0, 2, 0, 0},    // 4h__ - 高音4，十六分音符，310ms
    {3, 5, 0, 1, 0, 0},    // 3h_ - 高音3，八分音符，619ms
    {2, 5, 0, 0, 0, 0}  ,   // 2h- - 高音2，四分音符，1238ms（延音标记）


    // // 小节1: 3h 2h_ 1h 2h_ | 
    // {3, 5, 0, 0, 0, 0},    // 3h - 高音3，四分音符，1238ms
    // {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    // {1, 5, 0, 0, 0, 0},    // 1h - 高音1，四分音符，1238ms
    // {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    
    // // 小节2: 3h_-_ 4h__ 3h_ 2h-
    // {3, 5, 0, 1, 1, 0},    // 3h_-_ - 高音3，八分音符+延音=1238ms
    // {4, 5, 0, 2, 0, 0},    // 4h__ - 高音4，十六分音符，310ms
    // {3, 5, 0, 1, 0, 0},    // 3h_ - 高音3，八分音符，619ms
    // {2, 5, 0, 0, 0, 0}     // 2h- - 高音2，四分音符，1238ms（延音标记）
};

// 时值符号详细演示
NumberedNote timing_demo[] = {
    {1, 4, 0, 0, 0, 0},    // 1 - 四分音符 = 2拍 = 1238ms
    {1, 4, 0, 1, 0, 0},    // 1_ - 八分音符 = 1拍 = 619ms
    {1, 4, 0, 2, 0, 0},    // 1__ - 十六分音符 = 0.5拍 = 310ms
    {1, 4, 0, 1, 1, 0},    // 1_-_ - 八分音符+延音 = 2拍 = 1238ms
    {1, 4, 0, 0, 0, 1},    // 1. - 四分音符+附点 = 3拍 = 1857ms
    {1, 4, 0, 1, 0, 1}     // 1_. - 八分音符+附点 = 1.5拍 = 929ms
};

// 《春日影》修正版 - 根据正确规则解析
// 第一行: 3h 2L 1 2L | 3h. 4 3h 2h.
NumberedNote haruhi_correct[] = {
    // 第一小节
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符，1238ms
    {2, 3, 1, 1, 0, 0},     // 2#L - C#(升2)，八分音符，619ms
    {1, 4, 0, 0, 0, 0},     // 1 - 中音1，四分音符，1238ms
    {2, 3, 1, 1, 0, 0},     // 2#L - C#(升2)，八分音符，619ms
    {3, 5, 0, 0, 0, 1},     // 3h. - 高音3，四分音符+附点，1857ms
    {4, 4, 1, 0, 0, 0},     // 4# - F#(升4)，四分音符，1238ms
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符，1238ms
    {2, 5, 0, 0, 0, 1}      // 2h. - 高音2，四分音符+附点，1857ms
};

// 从nnnn.md转换的完整旋律
NumberedNote nnnn_full_melody[] = {
    // 3h 2h_ 1h 2h_ | 3h_-_ 4h__ 3h_ 2h- |
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {1, 5, 0, 0, 0, 0},     // 1h - 高音1，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {3, 5, 0, 1, 1, 0},     // 3h_-_ - 高音3，八分音符+延音
    {4, 5, 0, 2, 0, 0},     // 4h__ - 高音4，十六分音符
    {3, 5, 0, 1, 0, 0},     // 3h_ - 高音3，八分音符
    {2, 5, 0, 0, 0, 0},     // 2h- - 高音2，四分音符
    
    // 3h 2h_ 1h 2h_ | 3h_-_ 4h__ 3h_ 2h- |
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {1, 5, 0, 0, 0, 0},     // 1h - 高音1，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {3, 5, 0, 1, 1, 0},     // 3h_-_ - 高音3，八分音符+延音
    {4, 5, 0, 2, 0, 0},     // 4h__ - 高音4，十六分音符
    {3, 5, 0, 1, 0, 0},     // 3h_ - 高音3，八分音符
    {2, 5, 0, 0, 0, 0},     // 2h- - 高音2，四分音符
    
    // 3h 2h_ 1h 2h_ | 3h_-_ 4h__ 3h_ 2h 1__ 2__ |
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {1, 5, 0, 0, 0, 0},     // 1h - 高音1，四分音符
    {2, 5, 0, 1, 0, 0},     // 2h_ - 高音2，八分音符
    {3, 5, 0, 1, 1, 0},     // 3h_-_ - 高音3，八分音符+延音
    {4, 5, 0, 2, 0, 0},     // 4h__ - 高音4，十六分音符
    {3, 5, 0, 1, 0, 0},     // 3h_ - 高音3，八分音符
    {2, 5, 0, 0, 0, 0},     // 2h - 高音2，四分音符
    {1, 5, 0, 2, 0, 0},     // 1__ - 高音1，十六分音符
    {2, 5, 0, 2, 0, 0},     // 2__ - 高音2，十六分音符
    
    // 3_ 3_ 2_ 4_ 3_ 2_ |
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    
    // 2_ 2_ 1__ 1__ 4_ 3_ 2_ |
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    
    // 2 1__ 2__ 3- |
    {2, 4, 0, 0, 0, 0},     // 2 - 中音2，四分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {2, 4, 0, 2, 0, 0},     // 2__ - 中音2，十六分音符
    {3, 4, 0, 0, 1, 0},     // 3- - 中音3，四分音符+延音
    
    // 0- 3_ 5_ 1h_ |
    {0, 4, 0, 0, 1, 0},     // 0- - 休止符，四分音符+延音
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    
    // 7 1h_ 7 1h_ |
    {7, 4, 1, 0, 0, 0},     // 7# - A#(升7)，四分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    {7, 4, 1, 0, 0, 0},     // 7# - A#(升7)，四分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    
    // 7__ 6__ 5 5_ 2_ 4_ |
    {7, 4, 1, 2, 0, 0},     // 7#__ - A#(升7)，十六分音符
    {6, 4, 1, 2, 0, 0},     // 6#__ - G#(升6)，十六分音符
    {5, 4, 0, 0, 0, 0},     // 5 - 中音5，四分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    
    // 4 3_ 3 5L_ |
    {4, 4, 1, 0, 0, 0},     // 4# - F#(升4)，四分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {3, 4, 0, 0, 0, 0},     // 3 - 中音3，四分音符
    {4, 3, 1, 1, 0, 0},     // 4#L - F#(升4)，八分音符
    
    // 4_ 3_ 2_ 3 5_ |
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {3, 4, 0, 0, 0, 0},     // 3 - 中音3，四分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    
    // 1- 0 1_ |
    {1, 4, 0, 0, 1, 0},     // 1- - 中音1，四分音符+延音
    {0, 4, 0, 0, 0, 0},     // 0 - 休止符，四分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    
    // 2_ 1_-_ 1__ 1_ 5_ 1_ |
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {1, 4, 0, 1, 1, 0},     // 1_-_ - 中音1，八分音符+延音
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    
    // 4 3_ 2 1_ |
    {4, 4, 1, 0, 0, 0},     // 4# - F#(升4)，四分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 0, 0, 0, 0},     // 2 - 中音2，四分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    
    // 1- 0 1__ 2__ |
    {1, 4, 0, 0, 1, 0},     // 1- - 中音1，四分音符+延音
    {0, 4, 0, 0, 0, 0},     // 0 - 休止符，四分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {2, 4, 0, 2, 0, 0},     // 2__ - 中音2，十六分音符
    
    // 继续第二段...
    // 3_ 3_ 2_ 4_ 3_ 2_ |
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    
    // 2_ 2_ 1_ 4_ 3_ 2_ |
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    
    // 2 1__ 2__ 3- |
    {2, 4, 0, 0, 0, 0},     // 2 - 中音2，四分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {2, 4, 0, 2, 0, 0},     // 2__ - 中音2，十六分音符
    {3, 4, 0, 0, 1, 0},     // 3- - 中音3，四分音符+延音
    
    // 0- 3_ 5_ 1h_ |
    {0, 4, 0, 0, 1, 0},     // 0- - 休止符，四分音符+延音
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    
    // 7 1h_ 7 1h_ |
    {7, 4, 1, 0, 0, 0},     // 7# - A#(升7)，四分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    {7, 4, 1, 0, 0, 0},     // 7# - A#(升7)，四分音符
    {1, 5, 0, 1, 0, 0},     // 1h_ - 高音1，八分音符
    
    // 7__ 6__ 5 5_ 2_ 4_ |
    {7, 4, 1, 2, 0, 0},     // 7#__ - A#(升7)，十六分音符
    {6, 4, 1, 2, 0, 0},     // 6#__ - G#(升6)，十六分音符
    {5, 4, 0, 0, 0, 0},     // 5 - 中音5，四分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    
    // 4 3_ 3 5L_ |
    {4, 4, 1, 0, 0, 0},     // 4# - F#(升4)，四分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {3, 4, 0, 0, 0, 0},     // 3 - 中音3，四分音符
    {4, 3, 1, 1, 0, 0},     // 4#L - F#(升4)，八分音符
    
    // 4_ 3_ 2_ 3 5_ |
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {3, 4, 0, 1, 0, 0},     // 3_ - 中音3，八分音符
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {3, 4, 0, 0, 0, 0},     // 3 - 中音3，四分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    
    // 1- 0 1__ 1__ |
    {1, 4, 0, 0, 1, 0},     // 1- - 中音1，四分音符+延音
    {0, 4, 0, 0, 0, 0},     // 0 - 休止符，四分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    {1, 4, 0, 2, 0, 0},     // 1__ - 中音1，十六分音符
    
    // 2_ 1 1_ 5_ 1_ |
    {2, 4, 1, 1, 0, 0},     // 2#_ - C#(升2)，八分音符
    {1, 4, 0, 0, 0, 0},     // 1 - 中音1，四分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    {5, 4, 0, 1, 0, 0},     // 5_ - 中音5，八分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    
    // 4_ 4__ 4__ 3__ 2__ 2 1_ |
    {4, 4, 1, 1, 0, 0},     // 4#_ - F#(升4)，八分音符
    {4, 4, 0, 2, 0, 0},     // 4__ - 中音4，十六分音符
    {4, 4, 0, 2, 0, 0},     // 4__ - 中音4，十六分音符
    {3, 4, 0, 2, 0, 0},     // 3__ - 中音3，十六分音符
    {2, 4, 0, 2, 0, 0},     // 2__ - 中音2，十六分音符
    {2, 4, 0, 0, 0, 0},     // 2 - 中音2，四分音符
    {1, 4, 0, 1, 0, 0},     // 1_ - 中音1，八分音符
    
    // 1_-_ 0_-_ 0- |
    {1, 4, 0, 1, 1, 0},     // 1_-_ - 中音1，八分音符+延音
    {0, 4, 0, 1, 1, 0},     // 0_-_ - 休止符，八分音符+延音
    {0, 4, 0, 0, 1, 0},     // 0- - 休止符，四分音符+延音
};

// 播放函数
void play_example_melody(void)
{
    // 使用6/8拍，BPM=97
    Play_Numbered_Melody(example_melody, 
                        sizeof(example_melody)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}

void play_timing_demo(void)
{
    // 演示不同时值符号
    Play_Numbered_Melody(timing_demo, 
                        sizeof(timing_demo)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}

void play_haruhi_correct(void)
{
    // 播放修正版《春日影》
    Play_Numbered_Melody(haruhi_correct, 
                        sizeof(haruhi_correct)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}

void play_nnnn_full_melody(void)
{
    // 播放从nnnn.md转换的完整旋律
    uint16_t length = sizeof(nnnn_full_melody)/sizeof(NumberedNote);
    printf("Playing nnnn_full_melody, length=%d\n", length);
    Play_Numbered_Melody(nnnn_full_melody, 
                        length, 
                        TIME_SIGNATURE_6_8, 
                        97);
}
